{% extends "base.html" %}
{% block title %}NPACT - N-Profile Analysis Computational Tool{% endblock %}

{% macro emailinput() %}
<label>Email me the results @ <input id="email" name="email" type="email" value="{{ email }}">(optional)</label>
{% endmacro %}

{% block addScript %}
<script src="{{ url_for('static', filename='css/custom-theme/jquery-ui.min.js')}}"></script>
<script src="{{ url_for('static', filename='bower_components/qtip2/jquery.qtip.min.js')}}"></script>
<script type="text/javascript">
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
       results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

$(document).ready(function() {
    console.log("Startup");
    $('button').each(function() {
        if(!$(this).hasClass('btn-file')) {
            $(this).button();
        }
    });
    $('#startforms div').hide();
    var selectform = function(index) {
        console.log('Selecting form', index);
        if($('#form-'+index).css('display') == 'none') {
          $('#startforms div').hide();
          $('#form-'+index).slideDown();
        }
        $('#selectors button').removeClass('force-active');
        $('#btn-'+index).addClass('force-active');
        window.history.replaceState('active', index, '?active='+index);
    }
    $('#selectors button').on('click', function(evt) {
        selectform($(evt.target).parent().data('target'));
    });
    var active = getParameterByName('active');
    if(active) {
        selectform(active);
    }
});
</script>
{% endblock %}

{% block content %}
<div class="contentPadding">
  <h2>NPACT - N-Profile Analysis Computational Tool (Prokaryotes)</h2>
  <img src="{{ url_for('static', filename='images/dna.jpg') }}" alt="N-Profile Genbank Analysis Computational Tool image" style="margin:0 0 5px 8px; width:98%" />
  <p>For quantitative frame-analysis and identification of ORFs with statistically-significant 3-base periodicities in <b> prokaryotic sequences </b> NPACT is currently accepting sequence files in the GenBank format (see a <a href="http://www.ncbi.nlm.nih.gov/Sitemap/samplerecord.html">sample record</a> or the <a href="/about">About</a> page).</p>
  <p>After seleting a sequence file, "Start Analysis!" will result in a graphical output showing sequence compositional contrasts for frame analysis, coding region (CDS) annotation from the input file, and, by default, regions of non-random 3-base compositional periodicity (hits), newly-identified or modified ORFs, and corresponding output text files.  </p>

  <p class="orange-text">The NPACT server can process uploaded files, files fetched from a url, or
genbank data pasted directly in. <strong>Only one of the  following is neccessary</strong>.</p>
    <div id="msgpane" class="ui-corner-all">
       {% with messages = get_flashed_messages() %}
       {% if messages %}
       {% for message in messages %}
       <div class="message">
          <p class="ui-state-highlight ui-corner-all ui-state-error">
                               {{ message }}</p>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
</div>
  <input type="hidden" name="selected" value="" id="selected"/>
  <div>
    <h1>Step 1: Select a method below</h1>
  </div>
  <hr style="margin-top: 3px; margin-bottom: 10px;">
  <div id="selectors" style="margin-bottom: 15px;">
    <button data-target="upload" id="btn-upload">Upload a File</button>
    <button data-target="fetchurl" id="btn-fetchurl">Fetch from URL</button>
    <button data-target="pastein" id="btn-pastein">Paste in as text</button>
    <button data-target="search" id="btn-search">Accession Number</button>
  </div>
  <div id="startforms">
    <div id="form-upload">
      <h1>Step 2: Upload a File</h1>
      <hr style="margin-top: 3px; margin-bottom: 10px;">
      <form method="post" action="" enctype="multipart/form-data">
        <input id="file" name="file" type="file" title="Select a file for upload">
        {{emailinput()}}
        <button type="submit" name="active" value="upload" title="Get the analysis results based on default configuration.">
          <span class="ui-button-text">Start Analysis!</span>
        </button>
      </form>
    </div>
    <div id="form-fetchurl">
      <h1>Step 2: Enter a URL</h1>
      <hr style="margin-top: 3px; margin-bottom: 10px;">
      <form method="post" action="" enctype="multipart/form-data">
        <label>Url:
          <input id="fetchurl" name="fetchurl" type="url" value="{{ url }}">
        </label>
        {{emailinput()}}
        <button type="submit" name="active" value="fetchurl" title="Get the analysis results based on default configuration.">
          <span class="ui-button-text">Start Analysis!</span>
        </button>
      </form>
    </div>
    <div id="form-pastein">
      <h1 style="margin-bottom: 3px;">Step 2: Paste genome text below</h1>
      <p style="margin: 5px 0px 5px 0px;">Text can be in <a href="https://en.wikipedia.org/wiki/FASTA_format">FASTA format</a> or <a href="http://www.ncbi.nlm.nih.gov/Sitemap/samplerecord.html">GenBank format</a>.</p>
      <form method="post" action="" enctype="multipart/form-data">
        <textarea id="pastein" name="pastein" rows="4" value="{{ pastein }}"></textarea>
        {{emailinput()}}
        <button type="submit" name="active" value="pastein" title="Get the analysis results based on default configuration.">
          <span class="ui-button-text">Start Analysis!</span>
        </button>
      </form>
    </div>
    <div id="form-search">
      <h1>Step 2: Search by Accession Number</h1>
      <hr style="margin-top: 3px; margin-bottom: 10px;">
      <form method="post" action="" enctype="multipart/form-data">
        <label>Accession Number:
          <input id="entrez_search_term" name="search" type="search" value="{{ search }}">
        </label>
        {{emailinput()}}
        {% include "start/EntrezSearchForm.html" %}
        <button type="submit" name="active" value="search" title="Get the analysis results based on default configuration.">
          <span class="ui-button-text">Start Analysis!</span>
        </button>
      </form>
    </div>
  </div>

  <br/>
  <p id="start-over">
    <a href="">&laquo; Start Over</a>
  </p>
</div>
{% endblock content %}
